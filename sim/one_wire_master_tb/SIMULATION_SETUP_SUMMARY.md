# ModelSim ä»¿çœŸç¯å¢ƒé…ç½®å®Œæˆ

## âœ… å·²åˆ›å»ºçš„ä»¿çœŸå·¥ç¨‹

### 1. **one_wire_master_tb** (åº•å±‚é©±åŠ¨æµ‹è¯•)
ğŸ“ ä½ç½®: `F:\FPGA2025\sim\one_wire_master_tb\`

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `cmd.do` | 3.2 KB | ModelSim ä»¿çœŸè„šæœ¬ï¼ˆå®Œæ•´å¯è¿è¡Œï¼‰ |
| `README.md` | 3.8 KB | ä»¿çœŸæŒ‡å—ã€æ³¢å½¢è¯´æ˜ã€è°ƒè¯•æŠ€å·§ |

**åŠŸèƒ½**ï¼š
- âœ… æµ‹è¯• 1-Wire æ€»çº¿æ—¶åº
- âœ… å¤ä½ä¸åº”ç­”æ£€æµ‹
- âœ… å†™ä½æ“ä½œï¼ˆ0/1ï¼‰
- âœ… è¯»ä½æ“ä½œï¼ˆ0/1ï¼‰
- âœ… ä»æœºæ¨¡æ‹Ÿå™¨

**è¿è¡Œæ–¹å¼**ï¼š
```bash
cd F:\FPGA2025\sim\one_wire_master_tb
vsim -do cmd.do
```

---

### 2. **one_wire_handler_tb** (ä¸Šå±‚åè®®æµ‹è¯• - å¾…å®Œå–„)
ğŸ“ ä½ç½®: `F:\FPGA2025\sim\one_wire_handler_tb\`

| æ–‡ä»¶ | å¤§å° | è¯´æ˜ |
|------|------|------|
| `cmd.do` | 2.6 KB | ModelSim è„šæœ¬æ¡†æ¶ï¼ˆéœ€testbenchï¼‰ |
| `README.md` | 2.4 KB | å¾…å®Œæˆä»»åŠ¡æ¸…å•ã€æµ‹è¯•åœºæ™¯è®¾è®¡ |

**çŠ¶æ€**: âš ï¸ éœ€è¦åˆ›å»º `one_wire_handler_tb.v` æµ‹è¯•å°

**è§„åˆ’åŠŸèƒ½**ï¼š
- â˜ æµ‹è¯•å‘½ä»¤æ€»çº¿æ¥å£
- â˜ æµ‹è¯• FIFO åŠŸèƒ½
- â˜ æµ‹è¯• 4 ç§åŠŸèƒ½ç ï¼ˆ0x20-0x23ï¼‰
- â˜ éªŒè¯æ•°æ®ä¸Šä¼ æµ
- â˜ å®Œæ•´çš„ DS18B20 è¯»æ¸©åº¦æµç¨‹

---

## ğŸ“Š ä»¿çœŸå·¥ç¨‹å¯¹æ¯”

| ç‰¹æ€§ | one_wire_master_tb | one_wire_handler_tb |
|------|-------------------|-------------------|
| **å±‚æ¬¡** | åº•å±‚é©±åŠ¨ | ä¸Šå±‚åè®® |
| **çŠ¶æ€** | âœ… å®Œæ•´å¯ç”¨ | âš ï¸ å¾…å®Œå–„ |
| **æµ‹è¯•å°** | âœ… å·²åˆ›å»º | â˜ éœ€åˆ›å»º |
| **æµ‹è¯•å¯¹è±¡** | one_wire_master.v | one_wire_handler.v |
| **æµ‹è¯•ç²’åº¦** | ä½çº§æ“ä½œ | å­—èŠ‚çº§å‘½ä»¤ |

---

## ğŸ¯ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1: æµ‹è¯•åº•å±‚é©±åŠ¨ï¼ˆæ¨èå…ˆåšï¼‰

```bash
# 1. æ‰“å¼€ ModelSim
cd F:\FPGA2025\sim\one_wire_master_tb

# 2. æ‰§è¡Œä»¿çœŸè„šæœ¬
do cmd.do

# 3. è§‚å¯Ÿæ³¢å½¢
# - æ£€æŸ¥ 1-Wire æ€»çº¿æ—¶åº
# - éªŒè¯åº”ç­”æ£€æµ‹
# - ç¡®è®¤è¯»å†™ä½æ“ä½œ
```

**é¢„æœŸç»“æœ**ï¼š
```
[Test 1] PASS: Presence detected
[Test 4] PASS: Read bit = 0
[Test 5] PASS: Read bit = 1
All Tests Complete
```

---

### æ­¥éª¤2: åˆ›å»ºä¸Šå±‚æµ‹è¯•å°ï¼ˆå¯é€‰ï¼‰

å¦‚æœéœ€è¦æµ‹è¯•å®Œæ•´çš„å‘½ä»¤å¤„ç†æµç¨‹ï¼Œå¯ä»¥åˆ›å»º `one_wire_handler_tb.v`ï¼š

```verilog
// F:\FPGA2025\tb\one_wire_handler_tb.v
module one_wire_handler_tb;
    // å‚è€ƒ README.md ä¸­çš„ç»“æ„å»ºè®®
    // æˆ–å‚è€ƒ sim/spi_handler_tb/ ç¤ºä¾‹
endmodule
```

---

## ğŸ“‹ cmd.do è„šæœ¬è¯´æ˜

### one_wire_master_tb/cmd.do ç»“æ„

```tcl
# 1. æ¸…ç†å·¥ä½œåº“
quit -sim
vdel -lib work -all
vlib work

# 2. ç¼–è¯‘è®¾è®¡æ–‡ä»¶
vlog -sv ../../rtl/one_wire/one_wire_master.v
vlog -sv ../../tb/one_wire_master_tb.v

# 3. å¯åŠ¨ä»¿çœŸ
vsim work.one_wire_master_tb -voptargs="+acc" -t ps

# 4. æ·»åŠ æ³¢å½¢ï¼ˆ6ä¸ªåˆ†ç»„ï¼‰
add wave -group "Clock & Reset" ...
add wave -group "Control" ...
add wave -group "Status" ...
add wave -group "1-Wire Bus" ...
add wave -group "State Machine" ...
add wave -group "DUT Internal" ...

# 5. è¿è¡Œä»¿çœŸ
run -all
wave zoom full
```

### æ³¢å½¢åˆ†ç»„è¯´æ˜

| åˆ†ç»„ | ä¿¡å·æ•° | ç”¨é€” |
|------|--------|------|
| Clock & Reset | 2 | æ—¶é’Ÿå’Œå¤ä½ |
| Control | 4 | å¯åŠ¨ä¿¡å·å’Œæ•°æ®è¾“å…¥ |
| Status | 4 | çŠ¶æ€è¾“å‡ºå’Œç»“æœ |
| 1-Wire Bus | 3 | æ€»çº¿ä¿¡å·ï¼ˆå«ä»æœºæ¨¡æ‹Ÿï¼‰ |
| State Machine | 2 | çŠ¶æ€æœºçŠ¶æ€å’Œè®¡æ—¶å™¨ |
| DUT Internal | 2 | å†…éƒ¨æ§åˆ¶ä¿¡å· |

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹å…³é”®æ—¶åº

1. **å¤ä½è„‰å†²å®½åº¦**
   ```tcl
   # åœ¨æ³¢å½¢ä¸­æ·»åŠ å…‰æ ‡
   # æµ‹é‡ onewire_io æ‹‰ä½çš„æ—¶é—´
   # åº”çº¦ä¸º 480Î¼s (28800 æ—¶é’Ÿå‘¨æœŸ)
   ```

2. **åº”ç­”æ£€æµ‹çª—å£**
   ```tcl
   # æŸ¥çœ‹ state = ST_RESET_SAMPLE (3) æœŸé—´
   # onewire_io åº”è¢«ä»æœºæ‹‰ä½
   ```

3. **å†™ä½æ—¶åº**
   ```tcl
   # å†™0: ST_WRITE_LOW çŠ¶æ€çº¦ 60Î¼s (3600 å‘¨æœŸ)
   # å†™1: ST_WRITE_LOW çŠ¶æ€çº¦ 6Î¼s (360 å‘¨æœŸ)
   ```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

### è®¾è®¡æ–‡æ¡£
- `../../rtl/one_wire/one_wire_master.v` - æºä»£ç 
- `../../rtl/one_wire/one_wire_handler.v` - Handler æºç 
- `../../rtl/one_wire/PROTOCOL.md` - åè®®è¯¦è§£

### æµ‹è¯•å°
- `../../tb/one_wire_master_tb.v` - å·²åˆ›å»ºçš„æµ‹è¯•å°
- `../../tb/one_wire_handler_tb.v` - å¾…åˆ›å»º

### å‚è€ƒç¤ºä¾‹
- `../spi_handler_tb/cmd.do` - SPI handler ä»¿çœŸè„šæœ¬
- `../cdc_dsm_tb/cmd.do` - å¤æ‚ç³»ç»Ÿä»¿çœŸç¤ºä¾‹

---

## âš™ï¸ ç³»ç»Ÿè¦æ±‚

- **ä»¿çœŸå·¥å…·**: ModelSim 10.6c æˆ–æ›´é«˜ç‰ˆæœ¬
- **ç³»ç»Ÿ**: Windows/Linux
- **å†…å­˜**: å»ºè®® 4GB+
- **ç£ç›˜**: 100MB+ (å«æ³¢å½¢æ–‡ä»¶)

---

## ğŸ“ å­¦ä¹ å»ºè®®

### æ–°æ‰‹è·¯å¾„
1. å…ˆè¿è¡Œ `one_wire_master_tb` ç†è§£åº•å±‚æ—¶åº
2. é˜…è¯»æ³¢å½¢ï¼Œç†è§£ 1-Wire åè®®
3. ä¿®æ”¹æ—¶åºå‚æ•°ï¼Œè§‚å¯Ÿå½±å“
4. å­¦ä¹ ä»æœºæ¨¡æ‹Ÿå™¨çš„å®ç°

### è¿›é˜¶è·¯å¾„
1. åˆ›å»º `one_wire_handler_tb.v`
2. å®ç°å®Œæ•´çš„å‘½ä»¤æµ‹è¯•
3. æ·»åŠ é”™è¯¯æ³¨å…¥æµ‹è¯•
4. æ€§èƒ½ä¼˜åŒ–å’Œè¦†ç›–ç‡åˆ†æ

---

## ğŸš€ åç»­å·¥ä½œ

- [ ] å®Œå–„ `one_wire_handler_tb.v`
- [ ] æ·»åŠ è¦†ç›–ç‡æ”¶é›†è„šæœ¬
- [ ] åˆ›å»ºè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬
- [ ] é›†æˆåˆ° CI/CD æµç¨‹
- [ ] æ·»åŠ æ–­è¨€ (SystemVerilog Assertions)

---

**åˆ›å»ºæ—¥æœŸ**: 2025-10-12
**çŠ¶æ€**: one_wire_master_tb âœ… å®Œæˆ | one_wire_handler_tb âš ï¸ å¾…å®Œå–„
