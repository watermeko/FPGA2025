# USB-CDC通信协议

| 字段     | 字节数 |
| -------- | ------ |
| 帧头     | 2      |
| 功能码   | 1      |
| 数据长度 | 2      |
| 数据体   | 0-65535 |
|校验和|1|
|状态字| 1|

## 帧头

固定为0xAA55。

## 功能码

| 功能码 | 功能描述 | 
| ------ | -------- | 
| 0x01   | **配置SPI** | 
| 0x02   | **发送SPI数据** | 
| 0x03   | **接收SPI数据** |
| 0x04   | **配置I2C** | 
| 0x05   | **发送I2C数据** | 
| 0x06   | **接收I2C数据** |
| 0x07   | **配置UART** |
| 0x08   | **发送UART数据** | 
| 0x09   | **接收UART数据** | 
| 0xFE   | **配置PWM输出** |
|0xFF|**心跳测试**|

## 数据长度

- **值**: 16位无符号整数，例如 `0x000A` 表示数据体有10个字节。
- **字节序**: 大端模式（Big-Endian）**，即高字节在前。`0x000A` 发送时就是 `0x00` 先发，`0x0A` 后发。

## 数据体

### SPI配置 (功能码 0x01)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 模式 | 1 | SPI模式 (0-3) |
| 时钟频率 | 4 | 32位整数，单位Hz |
| 位顺序 | 1 | 0: MSB优先, 1: LSB优先 |
| 片选极性 | 1 | 0: 低电平有效, 1: 高电平有效 |

### SPI发送 (功能码 0x02)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 片选信号 | 1 | 片选线编号 |
| 发送数据 | N | 要发送的数据字节 |

### SPI接收 (功能码 0x03)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 片选信号 | 1 | 片选线编号 |
| 读取长度 | 2 | 要读取的数据字节数 |

响应数据体为实际读取到的数据字节

### I2C配置 (功能码 0x04)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 时钟频率 | 4 | 32位整数，单位Hz |
| 从机地址 | 1 | 7位从机地址 |

### I2C发送 (功能码 0x05)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 寄存器地址 | 1 | 目标寄存器地址 |
| 发送数据 | N | 要写入的数据字节 |

### I2C接收 (功能码 0x06)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 寄存器地址 | 1 | 目标寄存器地址 |
| 读取长度 | 2 | 要读取的数据字节数 |

响应数据体为实际读取到的数据字节

### UART配置 (功能码 0x07)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 波特率 | 4 | 32位整数，如9600, 115200等 |
| 数据位 | 1 | 5, 6, 7, 8 |
| 停止位 | 1 | 1, 1.5, 2 |
| 校验位 | 1 | 0: 无校验, 1: 奇校验, 2: 偶校验 |

### UART发送 (功能码 0x08)
数据体为要发送的原始数据字节

### UART接收 (功能码 0x09)
数据体为空，响应为接收到的数据字节

### PWM配置 (功能码 0xFE)
| 字段 | 字节数 | 说明 |
|------|--------|------|
| 通道号 | 1 | PWM输出通道编号 |
| 周期 | 4 | 32位整数，单位ns |
| 占空比 | 4 | 32位整数，单位ns |

### 心跳测试 (功能码 0xFF)
数据体为空，响应数据体也为空

## 校验和

从帧头开始到数据体结束的所有字节的累加和，取低8位。

